<!DOCTYPE html>
<html>
<head>
    <title>Areas - Proyect Sobek</title>
    {%  include 'includeScripts.html' %}
    <script>
        $(function() {
            $( "#from" ).datepicker({
                dateFormat: 'yy-mm-dd',
                defaultDate: "-2w",
                maxDate: "0",
                changeMonth: true,
                numberOfMonths: 3,
                onClose: function( selectedDate ) {
                    $( "#to" ).datepicker( "option", "minDate", selectedDate );
                }
            });
            $( "#to" ).datepicker({
                dateFormat: 'yy-mm-dd',
                defaultDate: "0",
                maxDate: "0",
                changeMonth: true,
                numberOfMonths: 3,
                onClose: function( selectedDate ) {
                    $( "#from" ).datepicker( "option", "maxDate", selectedDate );
                }
            });

            getFields('field');
        });


        function getAreaLog(){
            area_id = $('#area').val();
            if (area_id == null){
                hideTag('graphs');
                alert('No area has been selected');
                return;
            }
            if ( ( $('#from').val() === "") || ( $('#to').val() === "" ) ){
                alert('You must select a date Range to proceed');
                return;
            }
            $.ajax({
                url: "/Crop_Area_Log/",
                data: {
                    area_id : area_id,
                    min_date: $('#from').val() + ' 00:00:00',
                    max_date: $('#to').val() + ' 23:59:59'
                },
                success:function(data){
                    time_array =[];
                    ev_array = [];
                    $.each(data, function( index, value ) {

                        time_array.push(value.log_timestamp);
                        ev_array.push(value.area_ev);
                    });

                    var evChart = {
                        labels : time_array,
                        datasets : [
                            {
                                fillColor : "rgba(204,0,0,0.5)",
                                strokeColor : "rgba(204,0,0,1)",
                                pointColor : "rgba(204,0,0,1)",
                                pointStrokeColor : "#fff",
                                data : ev_array
                            }
                        ]
                    }
                    var weather_lineChart = new Chart($("#weather_canvas").get(0).getContext("2d")).Line(evChart);
                    showTag('graphs');
                }
            });
        }
  </script>
</head>
<body>
    {%  include 'nav.html' %}
    <section>
        <h1>Areas</h1>
        <p>
            Select the Area you wish to graph:
        </p>
        <label>Field</label>
        <select id="field" onchange="getAreas('area', 'field');"></select>
        <label >Area</label>
        <select id="area"></select>
        <p>Select the range of dates you wish to graph:</p>

        <label for="from">From</label>
        <input type="text" id="from" name="from">
        <label for="to">to</label>
        <input type="text" id="to" name="to">

        <button onclick="getAreaLog()">Graph</button>
        <button onclick="hideTag('graphs');">Clean</button>
    </section>
    <section id="graphs" style="display: none;">
        <h2>Evotranspiration</h2>
        <canvas id="weather_canvas" height="250" width="1000"></canvas>

    </section>
    {%  include 'footer' %}
</body>
</html>